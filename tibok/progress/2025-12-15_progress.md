# Progress Notes - December 15, 2025

## Session: Plugin System Phase 1

### Features Implemented

#### Plugin System Core
- **TibokPlugin protocol** - Extended with `icon` and `author` properties
- **PluginManager** - Added enable/disable/reload functionality
- **PluginStateManager** - New singleton for persisting plugin enabled state
- **PluginContext** - Provides registries to plugins during registration

#### Plugin Settings UI
- **PluginSettingsView** - New Settings tab for managing plugins
- Shows all available plugins with name, description, version, author
- Toggle switch to enable/disable each plugin
- State persists across app restarts via UserDefaults

#### Command Registry Enhancement
- Added `source` field to `Command` struct for tracking origin
- Added `unregister(source:)` method to remove all commands from a plugin
- Enables clean plugin unloading without orphaned commands

#### Syntax Highlighting Fix
- Fixed heading "shudder" when typing
- Changed from font-based highlighting to color-only
- Uses in-place attribute updates (`addAttributes()`) instead of string replacement
- No layout recalculation triggered during highlighting

### New Files Created
- `tibok/Plugins/PluginStateManager.swift` - Plugin state persistence
- `tibok/Views/PluginSettingsView.swift` - Settings UI for plugins

### Files Modified
- `tibok/Plugins/TibokPlugin.swift` - Added icon, author properties with defaults
- `tibok/Plugins/PluginManager.swift` - Enable/disable logic, availablePluginTypes tracking
- `tibok/Plugins/Builtin/CoreSlashCommandsPlugin.swift` - Added icon and author values
- `tibok/Models/AppState.swift` - Command source tracking, unregister method
- `tibok/Views/SettingsView.swift` - Added Plugins tab (5th tab)
- `tibok/Services/SyntaxHighlighter.swift` - Color-only highlighting to fix flicker

### Documentation Updates
- Created `user_docs/features/plugins.md` - Plugin management documentation
- Updated `user_docs/README.md` - Added Plugins link to features list
- Updated `planning/roadmap.md` - Marked Plugin Phase 1 as complete

### Technical Notes
- Plugins are compile-time only (no dynamic loading yet)
- Default behavior: all plugins enabled unless explicitly disabled
- Disabled plugins stored in `disabledPlugins` UserDefaults key
- Plugin unload removes from both SlashCommandRegistry and CommandRegistry
- Settings window size increased to 480x400 to accommodate new tab
